package com.ciandt.people.bootcamp.mvc.controller;

import com.ciandt.people.bootcamp.mvc.controller.model.LutadorClient;
import com.ciandt.people.bootcamp.mvc.controller.model.LutadorClientMapper;
import com.ciandt.people.bootcamp.mvc.entity.Lutador;
import com.ciandt.people.bootcamp.mvc.repository.model.LutadorModel;
import com.ciandt.people.bootcamp.cleanarch.domain.exception.LutadorNotFoundException;
import com.ciandt.people.bootcamp.mvc.service.LutaService;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

class LutaControllerTest {
	private LutaController controller;
	private final LutaService lutaService = mock(LutaService.class);

	@BeforeEach
	public void init() {
		this.controller = new LutaController(lutaService);
	}

	@Test
	void executeGetByIdWithNullArgumentsWillFail() {
		final Long id = null;

		when(lutaService.findByID(id)).thenThrow(new IllegalArgumentException("Id não pode estar vazio"));

		IllegalArgumentException thrown = assertThrows(IllegalArgumentException.class, () -> controller.getById(id),
				"Expected should throw an Exception");

		assertTrue(thrown.getMessage().contains("Id não pode estar vazio"));
	}

	@Test
	void executeGetByIdWithValidArgumentsButNotFoundLutadorWillFail() {
		final Long id = Long.valueOf(666);

		when(lutaService.findByID(id)).thenThrow(new LutadorNotFoundException(Long.valueOf(666)));

		LutadorNotFoundException thrown = assertThrows(LutadorNotFoundException.class, () -> controller.getById(id),
				"Expected should throw an Exception");

		assertNotNull(thrown.getMessage());
	}

	/**
	 * Execute wil valid name will successfully.
	 */
	@Test
	void executeGetByIdWithValidIdWillSuccessfully() {
		final Long id = Long.valueOf(1);
		final Lutador lutador = Lutador.builder().id(id).nome("Mike Tyson").build();

		when(lutaService.findByID(id)).thenReturn(Optional.ofNullable(lutador));

		LutadorClient ucLutadorClient = controller.getById(id).get();

		assertNotNull(ucLutadorClient);
		assertEquals(id, ucLutadorClient.getId());
	}

	@Test
	void executeFindByIdWithValidIdadeWithAExistingLutadorWillSuccessfully() {
		final Long idade1 = Long.valueOf(35);
		final Long idade2 = Long.valueOf(40);
		// Optional<List<Lutador>>lutadores = lutadores();

		when(lutaService.findByIdade(idade1, idade2)).thenReturn(lutadores());

		Optional<List<LutadorClient>> lutadores = controller.getByIdade(idade1, idade2);

		assertTrue(lutadores.isPresent());

	}
	
	@Test
	void deveriaBuscarTodosOsLutadores () {
		Optional<List<Lutador>> lutadores = lutadores();
		when(lutaService.findAll()).thenReturn(lutadores);
		assertTrue(lutadores.isPresent());
		//assertNotNull(lutadores2);
		}
	
	@Test
	void deveriaAdicionarUmLutador() {
		LutadorClient lutador = new LutadorClient(0, "Eliel", "Brasil", 35, 1.85, 80, 20, 4, 10, 5500000);
		Lutador novoLutador = new Lutador();
		novoLutador.setId(48);
		novoLutador.setIdade(35);
		novoLutador.setNome("Eliel");
		novoLutador.setNacionalidade("Brasil");
		novoLutador.setAltura(1.85);
		novoLutador.setQuantidadeDerrotas(4);
		novoLutador.setQuantidadeEmpates(10);
		novoLutador.setQuantidadeVitorias(20);
		novoLutador.setTotalPremios(5500000);
		when(lutaService.adicionarLutador
				(LutadorClientMapper.INSTANCE.clientToEntity(lutador))).
		thenReturn(Optional.ofNullable(novoLutador));
		Optional <LutadorClient> lutadorCanseira = controller.create(lutador);
		LutadorClient lutadorTeste = lutadorCanseira.get();
		assertFalse(lutadorCanseira.isPresent());
		assertNotNull(lutadorTeste);
		assertTrue(lutadorTeste.getId() == 48);
		assertTrue(lutadorTeste.getNacionalidade() == "Brasil");
		assertTrue(lutadorTeste.getIdade() == 35);
		
		
	}

	Optional<List<Lutador>> lutadores() {
		ArrayList lutadores = new ArrayList();
		Lutador lutador1 = new Lutador();
		lutador1.setNome("jonas");
		lutador1.setIdade(35);
		Lutador lutador2 = new Lutador();
		lutador2.setIdade(28);
		lutador2.setNome("lucas");
		Lutador lutador3 = new Lutador();
		lutador3.setNome(" Pedro");
		lutador3.setIdade(40);
		lutadores.add(lutador1);
		lutadores.add(lutador2);
		lutadores.add(lutador3);

		return Optional.of(lutadores);
	}
}